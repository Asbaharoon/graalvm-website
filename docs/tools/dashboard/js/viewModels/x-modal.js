define(["knockout","app/format","ojs/ojarraydataprovider","app/bgv-parse","ojs/ojdialog","ojs/ojlabel","ojs/ojformlayout","ojs/ojselectsingle","ojs/ojlabelvalue","ojs/ojfilepicker","ojs/ojbutton","ojs/ojinputtext","ojs/ojknockout"],(function(e,t,s,o){return function(i){this.clean=function(){document.getElementById("name").reset(),this.selectedFile(void 0),this.dataSourceName(void 0),this.selectedFileContent(void 0),this.showError(!1),this.error(void 0)},this.close=function(e){this.clean(),document.getElementById("modal").close()}.bind(this),this.ok=function(e){if(n(this.selectedFile(),this.dataSourceName(),this.showError)){const e=t.parse(this.selectedFile(),this.selectedFormat(),this.selectedFileContent());null!=e&&i.model.ensureDataSource(this.dataSourceName(),this.selectedFormat(),e).then(this.close).catch(e=>{this.clean(),this.showError(!0),this.error(e)})}}.bind(this),this.isVisible=e.pureComputed(function(){return this.selectedFileContent()}.bind(this)),this.selectedFormat=e.observable(t.defaultFormat);const r=t.formats.map(e=>({value:e,label:t.create(e).longName}));this.formats=new s(r,{keyAttributes:"value"}),this.error=e.observable(),this.description=e.pureComputed(function(){return t.create(this.selectedFormat()).description}.bind(this)),this.selectedFile=e.observable(),this.selectedFileContent=e.observable(),this.showError=e.observable(!1),this.selectListener=function(e){this.showError(!1),this.selectedFileContent(void 0),this.error(void 0);var t=e.detail.files;t.length>0&&(this.selectedFile(t[0].name),this.dataSourceName(t[0].name),t[0].name.endsWith(".dump")?t[0].text().then(e=>{this.selectedFileContent(e)}):t[0].name.endsWith(".bgv")?o.read(t[0]).then(e=>{this.selectedFileContent(e)}):(this.showError(!0),this.error("Unknown dump extension")))}.bind(this),this.message=e.pureComputed(function(){return this.showError()?this.error():this.selectedFile()?this.selectedFileContent()?this.selectedFile():"Loading to memory...":"No file selected"}.bind(this)),this.dataSourceName=e.observable();const n=function(e,t,s){let o=!1;return e||(s(!0),o=!0),t&&""!==t.trim()?i.model.dataSourceNameIndex.hasOwnProperty(t)&&(s(!0),this.error("Name already exists"),o=!0):(s(!0),this.error("Name not set"),o=!0),!o}.bind(this)}}));