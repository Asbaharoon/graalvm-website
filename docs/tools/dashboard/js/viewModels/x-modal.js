define(["knockout","app/format","ojs/ojarraydataprovider","app/bgv-parse","ojs/ojdialog","ojs/ojlabel","ojs/ojformlayout","ojs/ojselectsingle","ojs/ojlabelvalue","ojs/ojfilepicker","ojs/ojbutton","ojs/ojinputtext","ojs/ojknockout"],(function(e,t,s,i){return function(o){this.close=function(e){document.getElementById("name").reset(),this.selectedFile(void 0),this.dataSourceName(void 0),this.selectedFileContent(void 0),this.showError(!1),document.getElementById("modal").close()}.bind(this),this.ok=function(e){if(l(this.selectedFile(),this.dataSourceName(),this.showError)){const e=t.parse(this.selectedFile(),this.selectedFormat(),this.selectedFileContent());null!=e&&o.model.ensureDataSource(this.dataSourceName(),this.selectedFormat(),e).then(this.close)}}.bind(this),this.isVisible=e.observable(!1),this.selectedFormat=e.observable(t.defaultFormat);const a=t.formats.map(e=>({value:e,label:t.create(e).longName}));this.formats=new s(a,{keyAttributes:"value"}),this.description=e.pureComputed(function(){return t.create(this.selectedFormat()).description}.bind(this)),this.selectedFile=e.observable(),this.selectedFileContent=e.observable(),this.selectListener=function(e){this.showError(!1);var t=e.detail.files;t.length>0&&(this.selectedFile(t[0].name),this.dataSourceName(t[0].name),t[0].name.endsWith(".dump")?t[0].text().then(e=>{this.selectedFileContent(e),this.isVisible(!0)}):t[0].name.endsWith(".bgv")&&i.read(t[0]).then(e=>{this.selectedFileContent(e),this.isVisible(!0)}))}.bind(this),this.showError=e.observable(!1),this.message=e.pureComputed(function(){return this.selectedFile()?this.selectedFileContent()?this.selectedFile():"Uploading...":"No file selected"}.bind(this)),this.dataSourceName=e.observable();const l=function(e,t,s){let i=!1;if(e||(s(!0),i=!0),t&&""!==t.trim()){if(o.model.dataSourceNameIndex.hasOwnProperty(t)){let e=document.getElementById("name");e.messagesCustom=[{summary:"Error",detail:"Name already exists"}],e.showMessages(),i=!0}}else{let e=document.getElementById("name");e.messagesCustom=[{summary:"Error",detail:"Name not set"}],e.showMessages(),i=!0}return!i}.bind(this)}}));