define(["knockout","app/format","app/util"],(function(t,e,i){"use strict";class a{constructor(t,e,i,a,s,o){this.id=t,this.componentName=e,this.dataSource=i,this.sectionName=a,this.section=s,this.contextualData=o,this.focus=-1}}class s{constructor(t,e,i,a){this.id=t,this.name=e,this._formatName=i,this.data=a}get format(){return e.create(this._formatName)}componentFor(t){return this.format.sections[t].component}sectionFor(t){return this.data[t]}}return class{constructor(){this.tiles=[],this.visibleTiles=t.observableArray(),this.tileIndex={},this.dataSources=t.observableArray(),this.activeDataSources=[],this.dataSourceIndex={},this.dataSourceNameIndex={},this.dataSourceTileMap={},this.dataSourceMap=t.pureComputed(function(){const t={};return this.dataSources().forEach(e=>{t[e.id]=e}),t}.bind(this))}async ensureDataSource(t,e,a){if(!(t in this.dataSourceIndex)){const o=new s(i.dataSourceIdGenerator.newId(),t,e,await a);this.dataSourceNameIndex[o.name]=o,this.dataSourceIndex[o.id]=o,this.dataSources.push(o),this.activeDataSources.push(o)}return this.dataSourceNameIndex[t]}addTile(t,e,s,o,r){const c=new a(i.tileIdGenerator.newId(),t,e,s,o,r);this.tiles.push(c),this.visibleTiles.splice(0,0,c),this.tileIndex[c.id]=c,this.dataSourceTileMap[c.dataSource.id]=c}hideTile(t){this._removeTileFromVisibleList(t),this._removeDataSourceFromActiveList(this.tileIndex[t].dataSource.id)}activateDataSource(t){this._addDataSourceToActiveList(t),this._addTileToVisibleList(this.dataSourceTileMap[t].id)}deactivateDataSource(t){this._removeDataSourceFromActiveList(t),this._removeTileFromVisibleList(this.dataSourceTileMap[t].id)}_addTileToVisibleList(t){this.visibleTiles().find(e=>e.id===t)||this.visibleTiles.splice(0,0,this.tileIndex[t])}_removeTileFromVisibleList(t){this.visibleTiles.remove(e=>e.id===t)}_addDataSourceToActiveList(t){-1===this.activeDataSources.findIndex(e=>e.id===t)&&this.activeDataSources.push(this.dataSourceIndex[t])}_removeDataSourceFromActiveList(t){const e=this.activeDataSources.findIndex(e=>e.id===t);-1!==e&&this.activeDataSources.splice(e,1)}}}));